
function negoChange(_name,_status){var logicName=_name.split('.');var fullDuplexId='#cbi-ethernet-'+logicName[2]+'-full_duplex';var linkSpeedId='#cbi-ethernet\\-'+logicName[2]+'\\-link_speed';if(_status){$(fullDuplexId).hide();$(linkSpeedId).hide();}else{$(fullDuplexId).show();$(linkSpeedId).show();}}
function linkspeedChange(_name,_val){var logicName=_name.split('.');var fullDuplexId='#cbid\\.ethernet\\.'+logicName[2]+'\\.full_duplex';if(_val==='1Gbps'){$(fullDuplexId).prop('checked',true);$(fullDuplexId).prop('disabled',true);}else{$(fullDuplexId).removeAttr('disabled');}}
function is_vlan_selectable(logicName,vlanVal){if(vlanVal===''){return false;}
var ifmembers=vlan_ifaces[vlanVal].split(' ');for(var j=0;j<ifmembers.length;j++){var ifmember=ifmembers[j];if(ifmember.indexOf(logicName+'.')>-1){return true;}}
return false;}
function setVlanError(logicName,err_ctrl){var $vlanErrorAlert=$('#'+logicName+'_vlan_tag_iface_error');var $vlanId=$('#cbid\\.ethernet\\.'+logicName+'\\.vlan_network_name');var $parentTab=$('a[href="#'+logicName+'"]');set_err_msg($vlanId,err_ctrl,'This VLAN network cannot be selected.');if(err_ctrl){$vlanErrorAlert.removeClass('hidden');$parentTab.css('color','red');$('#btn_save').attr('disabled','disabled');}else{$vlanErrorAlert.addClass('hidden');$parentTab.css('color','');if($('.tooltip-error').length==0){$('#btn_save').removeAttr('disabled');}}}
function setBridgeError(logicName,err_ctrl){var $bridgeErrorAlert=$('#'+logicName+'_wan_bridge_iface_error');var $networkBehaviorId=$('#cbid\\.ethernet\\.'+logicName+'\\.network_behavior');set_err_msg($networkBehaviorId,err_ctrl,'This network behavior cannot be selected.');if(err_ctrl){$bridgeErrorAlert.removeClass('hidden');}else{$bridgeErrorAlert.addClass('hidden');}}
function vlanIdChange($vlanId,logicName){var $parentTab=$('a[href="#'+logicName+'"]');if(is_vlan_selectable(logicName,$vlanId.val())){setVlanError(logicName,true);}else{setVlanError(logicName,false);}}
function validateNetworkBehavior(){for(var i=0;i<logical_name_arr.length;i++){var networkBehaviorId='#cbid\\.ethernet\\.'+logical_name_arr[i]+'\\.network_behavior';if($(networkBehaviorId).val()=='wan'&&wan_proto=='3g'){return false;}}
return true;}
function networkBehaviorChange(logicName){var $vlanId=$('#cbid\\.ethernet\\.'+logicName+'\\.vlan_network_name');if($vlanId.length){$vlanId.change(function(){vlanIdChange($vlanId,logicName);});vlanIdChange($vlanId,logicName);}else{setTimeout(networkBehaviorChange,100,logicName);}}
function networkBehaviorBridgeChange(logicName){if(wan_proto=='3g'){setBridgeError(logicName,true);}else{setBridgeError(logicName,false);}}
$(document).ready(function(){for(var i=0;i<logical_name_arr.length;i++){var linkSpeedId='#cbid\\.ethernet\\.'+logical_name_arr[i]+'\\.link_speed';var $linkSpeed=$(linkSpeedId);var autoNegoId='#cbid\\.ethernet\\.'+logical_name_arr[i]+'\\.auto_nego';var $autoNego=$(autoNegoId);var networkBehaviorId='#cbid\\.ethernet\\.'+logical_name_arr[i]+'\\.network_behavior';var $networkBehavior=$(networkBehaviorId);if($autoNego.length){$autoNego.change(function(){negoChange(this.id,$(this).is(':checked'));});negoChange($autoNego.attr('id'),$autoNego.is(':checked'));}
if($linkSpeed.length){$linkSpeed.change(function(){linkspeedChange(this.id,this.value);});linkspeedChange($linkSpeed.attr('id'),$linkSpeed.val());}
if($networkBehavior.length){$networkBehavior.change(function(){var logicName=this.id.split('.')[2];if(this.value=='vlan'){networkBehaviorChange(logicName);}else if(this.value=='wan'){networkBehaviorBridgeChange(logicName);}else{setVlanError(logicName,false);setBridgeError(logicName,false);}});var logicName=$networkBehavior.attr('id').split('.')[2];if($networkBehavior.val()==='vlan'){networkBehaviorChange(logicName);}else if($networkBehavior.val()==='wan'){networkBehaviorBridgeChange(logicName);}else{setVlanError(logicName,false);setBridgeError(logicName,false);}}}
$('#cbi').submit(function(){if(!validateNetworkBehavior()){$('#form_error_msg').text('Some fields are invalid, please see messages below!');$('#form_error_msg_placeholder').removeClass('hide');return false;}else{return true;}});});