'use strict';'require view';'require dom';'require poll';'require rpc';'require uci';'require form';'require validation';return view.extend({load:function(){return Promise.all([uci.load('network'),uci.load('dhcp')]);},render:function(){var m,s,o;m=new form.Map('network',_('Local Networks'),'');m.chain('dhcp');var networkSections=uci.sections('network');for(var i=0;i<networkSections.length;i++){var networkSection=networkSections[i],sid=networkSection['.name'],network_name=networkSection.name||sid;if(network_name=='lan'){s=m.section(form.NamedSection,network_name,'interface');o=s.option(form.Value,'ipaddr',_('IP Address'));o.datatype='ip4addr';o=s.option(form.Value,'netmask',_('Subnet Mask'));o.datatype='ip4addr';o=s.option(form.Value,'mtu',_('MTU Size'));o.datatype='range(1400,1500)';o.default='1500';o=s.option(form.Flag,'ignore',_('DHCP Server'));o.uciconfig='dhcp';o.ucisection='lan';o.ucioption='ignore';o.default=o.disabled;o.enabled="0";o.disabled="1";o=s.option(form.Value,'start',_('DHCP Start'));o.uciconfig='dhcp';o.ucisection='lan';o.ucioption='start';o.datatype='range(1,254)';o.default='100';o=s.option(form.Value,'limit',_('DHCP Limit'));o.uciconfig='dhcp';o.ucisection='lan';o.ucioption='limit';o.datatype='uinteger';o.default='150';o.validate=function(network_name,value){var dhcp_start=$('#cbid\\.dhcp\\.lan\\.start').val(),limit_value=255-dhcp_start;if(value>0){if(value>limit_value){return _('Allowed values are integers between 1 and '+limit_value+', inclusive');}}else{return _('Invalid entry! Must be an integer greater than 0');}
return true;};o=s.option(form.ListValue,'leasetime',_('DHCP Lease Time'));o.uciconfig='dhcp';o.ucisection='lan';o.ucioption='leasetime';o.value('5m',_('5min'));o.value('30m',_('30min'));o.value('1h',_('1hr'));o.value('3h',_('3hr'));o.value('6h',_('6hr'));o.value('8h',_('8hr'));o.value('12h',_('12hr'));o.value('24h',_('1 day'));o.value('72h',_('3 days'));o.value('168h',_('1 week'));o.default='5m';o=s.option(form.TextValue,'dhcp_option',_('Custom DHCP DNS Servers'));o.uciconfig='dhcp';o.ucisection='lan';o.ucioption='dhcp_option';o.rows=3;o.cols=50;o.optional=true;o.placeholder='Enter one IP address per line up to three addresses';o.validate=function(network_name,value){if(value.length>0){var input_val_arr=value.split('\n');if(input_val_arr.length>3){return _('Invalid input! Cannot enter more than three addresses!');}else{for(var j=0;j<input_val_arr.length;j++){var ipformat=/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;if(input_val_arr[j].match(ipformat)==null)
return _('One of the addresses is invalid IP address format!');}}}
return true;};o.cfgvalue=function(network_name){var dns_list=uci.get('dhcp',network_name,'dhcp_option');if(dns_list!==undefined){var dns_array=dns_list.toString().split(',');dns_array.shift();var dns_ser=dns_array.join('\n');return dns_ser}};o.write=function(network_name,value){var all_val_arr=value.split('\n');if(all_val_arr!==undefined){var all_val=all_val_arr.join();var send_val=[];send_val[0]=_('6,%s'.format(all_val));uci.set('dhcp',network_name,'dhcp_option',send_val);uci.save();}};o=s.option(form.Flag,'stp',_('STP'));o.rmempty=false;o=s.option(form.ListValue,'smart_isolation',_('Smart Isolation'));o.value('0',_('Disable (full access)'));o.value('1',_('Internet access only'));o.value('2',_('LAN access only'));o.value('3',_('Internet access strict'));o.default='0';}}
return m.render();}});