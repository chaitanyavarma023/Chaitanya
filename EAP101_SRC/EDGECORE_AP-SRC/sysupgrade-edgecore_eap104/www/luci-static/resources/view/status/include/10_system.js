'use strict';'require baseclass';'require fs';'require rpc';var callSystemBoard=rpc.declare({object:'system',method:'board'});var callSystemInfo=rpc.declare({object:'system',method:'info'});var callECinfo=rpc.declare({object:'luci',method:'getECinfo'});function mem_pc(value,max,byte){var vn=parseInt(value)||0,mn=parseInt(max)||100,pc=Math.floor((100/mn)*vn);return'%d%%'.format(pc);}
return baseclass.extend({title:_('Device Info'),load:function(){return Promise.all([L.resolveDefault(callSystemBoard(),{}),L.resolveDefault(callSystemInfo(),{}),L.resolveDefault(callECinfo(),{}),fs.lines('/usr/lib/lua/luci/version.lua')]);},render:function(data){var boardinfo=data[0],systeminfo=data[1],ECinfo=data[2],luciversion=data[3];luciversion=luciversion.filter(function(l){return l.match(/^\s*(luciname|luciversion)\s*=/);}).map(function(l){return l.replace(/^\s*\w+\s*=\s*['"]([^'"]+)['"].*$/,'$1');}).join(' ');var datestr=null;if(systeminfo.localtime){var date=new Date(systeminfo.localtime*1000);datestr='%04d-%02d-%02d %02d:%02d:%02d'.format(date.getUTCFullYear(),date.getUTCMonth()+1,date.getUTCDate(),date.getUTCHours(),date.getUTCMinutes(),date.getUTCSeconds());}
var mem=L.isObject(systeminfo.memory)?systeminfo.memory:{};var mem_usage=(mem.total&&mem.free)?(mem.total-mem.free):null;var fields=[_('Firmware'),ECinfo.release+'-'+ECinfo.revision,_('Serial Number'),ECinfo.snum,_('System MAC'),ECinfo.mac,_('MTU'),ECinfo.mtu,_('Uptime'),systeminfo.uptime?'%t'.format(systeminfo.uptime):null,_('Load Average'),Array.isArray(systeminfo.load)?'%.2f, %.2f, %.2f'.format(systeminfo.load[0]/65535.0,systeminfo.load[1]/65535.0,systeminfo.load[2]/65535.0):null,_('Memory Used'),mem_pc(mem_usage,mem.total,true)];var table=E('div',{'class':'table'});for(var i=0;i<fields.length;i+=2){table.appendChild(E('div',{'class':'tr'},[E('div',{'class':'td left','width':'33%'},[fields[i]]),E('div',{'class':'td left'},[(fields[i+1]!=null)?fields[i+1]:'?'])]));}
return table;}});