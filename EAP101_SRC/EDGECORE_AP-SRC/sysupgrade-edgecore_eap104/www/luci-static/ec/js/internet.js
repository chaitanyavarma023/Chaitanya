
var wan_type_id='#cbid\\.network\\.wan\\.proto';var inet_src_id='#cbid\\.network\\.wan\\.inet_src';var wan_ip_id='#cbid\\.network\\.wan\\.ipaddr';var wan_netmask_id='#cbid\\.network\\.wan\\.netmask';var wan_netmask_select_id='#cbi\\.combobox\\.cbid\\.network\\.wan\\.netmask';var wan_gateway_id='#cbid\\.network\\.wan\\.gateway';var fallback_ip_id='#cbid\\.network\\.wan\\.fallback_ip';var fallback_nm_id='#cbid\\.network\\.wan\\.fallback_nm';var fallback_nm_select_id='#cbi\\.combobox\\.cbid\\.network\\.wan\\.fallback_nm';var wan_ipv6_ip_id='#cbid\\.network\\.wan\\.ip6addr';var lte_service_id='#cbid\\.network\\.wan\\.service_3g';var mgmtVlanEnableId='#cbid\\.network\\.managementvlan\\.enabled';var mgmtVlanTypeId='#cbid\\.network\\.managementvlan\\.proto';var mgmtVlanIfnameId='#cbid\\.network\\.managementvlan\\.ifname';var mgmtVlanIpId='#cbid\\.network\\.managementvlan\\.ipaddr';var mgmtVlanNetmaskId='#cbid\\.network\\.managementvlan\\.netmask';var mgmtVlanNetmaskSelectId='#cbi\\.combobox\\.cbid\\.network\\.managementvlan\\.netmask';var mgmtVlanGatewayId='#cbid\\.network\\.managementvlan\\.gateway';var mgmtVlanFallbackIpId='#cbid\\.network\\.managementvlan\\.fallback_ip';var mgmtVlanFallbackNmId='#cbid\\.network\\.managementvlan\\.fallback_nm';var mgmtVlanFallbackNmSelectId='#cbi\\.combobox\\.cbid\\.network\\.managementvlan\\.fallback_nm';var vlanTagEnableId='#cbid\\.network\\.wanvlan\\.enabled';var vlanTagTypeId='#cbid\\.network\\.wanvlan\\.proto';var vlanTagIfnameId='#cbid\\.network\\.wanvlan\\.ifname';var vlanTagIpId='#cbid\\.network\\.wanvlan\\.ipaddr';var vlanTagNetmaskId='#cbid\\.network\\.wanvlan\\.netmask';var vlanTagNetmaskSelectId='#cbi\\.combobox\\.cbid\\.network\\.wanvlan\\.netmask';var vlanTagGatewayId='#cbid\\.network\\.wanvlan\\.gateway';var vlanTagFallbackIpId='#cbid\\.network\\.wanvlan\\.fallback_ip';var vlanTagFallbackNmId='#cbid\\.network\\.wanvlan\\.fallback_nm';var vlanTagFallbackNmSelectId='#cbi\\.combobox\\.cbid\\.network\\.wanvlan\\.fallback_nm';var wan_proto_row='#cbi-network-wan-proto';var hostname_id='#cbid\\.network\\.wan\\.hostname';var mtu_id='#cbid\\.network\\.wan\\.mtu';var wan_dns_id='#cbid\\.network\\.wan\\.dns';var wan_service_id='#cbid\\.network\\.wan\\.service';var wan_username_id='#cbid\\.network\\.wan\\.username';var wan_password_id='#cbid\\.network\\.wan\\.password';var wantype_configured_val='';function validateDuplicatedVLAN(input_vlan,input_id,error_msg){for(var i=0;i<vlan_data.length;i++){if(input_vlan===vlan_data[i]){set_err_msg($(input_id),true,error_msg+_('Id is duplicated with other VLAN Id.'));return false;}}
return true;}
function validateOtherIP(input_value,input_id){for(var ipentry in ipdata){if(ipdata.hasOwnProperty(ipentry)){if(!ipentry.startsWith('wan')&&!ipentry.startsWith('mgmt')&&!ipentry.startsWith('vlantag')){var _ipentry=ipdata[ipentry];if(input_value===_ipentry.ip){set_err_msg($(input_id),true,_('Your Internet IP address is the same as the %s IP address!').format(_ipentry.friendly));return false;}
if(is_in_netmask(_ipentry.ip,_ipentry.nm,input_value)){set_err_msg($(input_id),true,_('Your Internet IP address falls in the same subnet as the %s network IP address.').format(_ipentry.friendly));return false;}}}}
return true;}
function validateWithAliasIP(input_ip,input_ip_id,input_gw,input_gw_id){var ipAliasArray=getIpAliasAddressList();for(var i=0;i<ipAliasArray['IP'].length;i++){if(is_in_netmask(ipAliasArray['IP'][i],ipAliasArray['Netmask'][i],input_ip)){set_err_msg($(input_ip_id),true,_('Your Internet IP address falls in the same subnet as the IP Aliases address.'));return false;}
if(input_gw!=''){if(is_in_netmask(ipAliasArray['IP'][i],ipAliasArray['Netmask'][i],input_gw)){set_err_msg($(input_gw_id),true,_('Your Internet IP address falls in the same subnet as the IP Aliases address.'));return false;}}}
return true;}
function getIpAliasAddressList(){var _ipAliasArray=new Array();_ipAliasArray['IP']=new Array();_ipAliasArray['Netmask']=new Array();$("#table_ip_alias_wan").find(".cbi-value-field input").each(function(input){if(this.id.indexOf('ipaddr')>=0&&this.value!=''){var tr_css_display=($(this).closest('tr').css('display')!='none');if(tr_css_display){_ipAliasArray['IP'].push(this.value);}}
if(this.id.indexOf('netmask')>=0&&this.value!=''){var tr_css_display=($(this).closest('tr').css('display')!='none');if(tr_css_display){_ipAliasArray['Netmask'].push(this.value);}}});return _ipAliasArray;}
function validateWANIpAddrs(){var wan_type=$(wan_type_id).val();clear_validate_error(wan_ip_id);clear_validate_error(wan_netmask_id);clear_validate_error(wan_gateway_id);clear_validate_error(fallback_ip_id);clear_validate_error(fallback_nm_id);clear_validate_error(wan_dns_id);clear_validate_error(wan_service_id);clear_validate_error(wan_username_id);clear_validate_error(wan_password_id);if(wan_type==='static'){var wan_ip=$(wan_ip_id).val();var wan_netmask=$(wan_netmask_id).val();var wan_gateway=$(wan_gateway_id).val();var wan_dns=$(wan_dns_id).val();if(!validateIpAndNetmask(wan_ip_id,wan_netmask_id)){return false;}
if(!validateIpAndNetmask(wan_gateway_id,wan_netmask_id)){return false;}
if(!is_in_netmask(wan_ip,wan_netmask,wan_gateway)){set_err_msg($(wan_gateway_id),true,_('IP address is not in the WAN subnet.'));return false;}
if(!validateOtherIP(wan_ip,wan_ip_id)){return false;}
if(!validateWithAliasIP(wan_ip,wan_ip_id,wan_gateway,wan_gateway_id)){return false;}
if(typeof wan_dns!=="undefined"&&!custom_dns(wan_dns,1,64)){set_err_msg($(wan_dns_id),true,_('Not a valid IP address or DNS servers exceed 4.'));return false;}
return true;}else if(wan_type==='dhcp'){var fallback_ip=$(fallback_ip_id).val();if(!validateIpAndNetmask(fallback_ip_id,fallback_nm_id)){return false;}
if(!validateOtherIP(fallback_ip,fallback_ip_id)){return false;}
if(!validateWithAliasIP(fallback_ip,fallback_ip_id)){return false;}}
else if(wan_type==='pppoe'){var wan_username=$(wan_username_id).val();var wan_password=$(wan_password_id).val();if(wan_username.length==0){set_err_msg($(wan_username_id),true,_('Should not be empty.'));return false;}
if(wan_password.length==0){set_err_msg($(wan_password_id),true,_('Should not be empty.'));return false;}}
return true;}
function validateVLANTag(){var vlanTagEnableVal=$(vlanTagEnableId).is(':checked');var vlanTagIfnamegValue=$(vlanTagIfnameId).val();var vlanTagType=$(vlanTagTypeId).val();clear_validate_error(vlanTagIpId);clear_validate_error(vlanTagNetmaskId);clear_validate_error(vlanTagGatewayId);clear_validate_error(vlanTagFallbackIpId);clear_validate_error(vlanTagFallbackNmId);clear_validate_error(vlanTagIfnameId);if(vlanTagEnableVal){var res_vlan_tag_id=true;var mgmtVlanEnableVal=$(mgmtVlanEnableId).is(':checked');var mgmtVlanIfnameValue=$(mgmtVlanIfnameId).val();if(mgmtVlanEnableVal&&vlanTagIfnamegValue!=''&&mgmtVlanIfnameValue!=''){if(vlanTagIfnamegValue===mgmtVlanIfnameValue){set_err_msg($(vlanTagIfnameId),true,_('WAN VLAN Id is duplicated with Mgmt VLAN Id.'));return false;}}
if(!is_in_range(vlanTagIfnamegValue,2,4094)){set_err_msg($(vlanTagIfnameId),true,_('Allowed values are integers between %d and %d, inclusive.').format(2,4094));res_vlan_tag_id=false;}
if(res_vlan_tag_id&&vlan_data.length!==0){res_vlan_tag_id=validateDuplicatedVLAN(vlanTagIfnamegValue,vlanTagIfnameId,'WAN VLAN');}
if(vlanTagType==='static'){var wan_ip=$(vlanTagIpId).val();var wan_netmask=$(vlanTagNetmaskId).val();var wan_gateway=$(vlanTagGatewayId).val();if(!validateIpAndNetmask(vlanTagIpId,vlanTagNetmaskId)){return false;}
if(!validateIpAndNetmask(vlanTagGatewayId,vlanTagNetmaskId)){return false;}
if(!is_in_netmask(wan_ip,wan_netmask,wan_gateway)){set_err_msg($(vlanTagGatewayId),true,_('IP address is not in the WAN VLAN subnet.'));return false;}
if(!validateOtherIP(wan_ip,vlanTagIpId)){return false;}
if(!validateWithAliasIP(wan_ip,vlanTagIpId,wan_gateway,vlanTagGatewayId)){return false;}
return res_vlan_tag_id;}else if(vlanTagType==='dhcp'){var fallback_ip=$(vlanTagFallbackIpId).val();if(!validateIpAndNetmask(vlanTagFallbackIpId,vlanTagFallbackNmId)){return false;}
if(!validateOtherIP(fallback_ip,vlanTagFallbackIpId)){return false;}
if(!validateWithAliasIP(fallback_ip,vlanTagFallbackIpId)){return false;}
return res_vlan_tag_id;}}
return true;}
function validateMgmtVLAN(){var mgmtVlanEnableVal=$(mgmtVlanEnableId).is(':checked');var mgmtVlanIfnameValue=$(mgmtVlanIfnameId).val();var mgmtVlanType=$(mgmtVlanTypeId).val();clear_validate_error(mgmtVlanIpId);clear_validate_error(mgmtVlanNetmaskId);clear_validate_error(mgmtVlanGatewayId);clear_validate_error(mgmtVlanFallbackIpId);clear_validate_error(mgmtVlanFallbackNmId);clear_validate_error(mgmtVlanIfnameId);if(mgmtVlanEnableVal){var res_mgmt_id=true;var vlanTagEnableVal=$(vlanTagEnableId).is(':checked');var vlanTagIfnameValue=$(vlanTagIfnameId).val();if(vlanTagEnableVal&&mgmtVlanIfnameValue!=''&&vlanTagIfnameValue!=''){if(vlanTagIfnameValue===mgmtVlanIfnameValue){set_err_msg($(mgmtVlanIfnameId),true,_('Mgmt VLAN Id is duplicated with WAN VLAN Id.'));return false;}}
if(!is_in_range(mgmtVlanIfnameValue,2,4094)){set_err_msg($(mgmtVlanIfnameId),true,_('Allowed values are integers between %d and %d, inclusive.').format(2,4094));res_mgmt_id=false;}
if(res_mgmt_id&&vlan_data.length!==0){res_mgmt_id=validateDuplicatedVLAN(mgmtVlanIfnameValue,mgmtVlanIfnameId,'Mgmt VLAN');}
if(mgmtVlanType==='static'){var wan_ip=$(mgmtVlanIpId).val();var wan_netmask=$(mgmtVlanNetmaskId).val();var wan_gateway=$(mgmtVlanGatewayId).val();if(!validateIpAndNetmask(mgmtVlanIpId,mgmtVlanNetmaskId)){return false;}
if(!validateIpAndNetmask(mgmtVlanGatewayId,mgmtVlanNetmaskId)){return false;}
if(!is_in_netmask(wan_ip,wan_netmask,wan_gateway)){set_err_msg($(mgmtVlanGatewayId),true,_('IP address is not in the Mgmt VLAN subnet.'));return false;}
if(!validateOtherIP(wan_ip,mgmtVlanIpId)){return false;}
if(!validateWithAliasIP(wan_ip,mgmtVlanIpId,wan_gateway,mgmtVlanGatewayId)){return false;}
return res_mgmt_id;}else if(mgmtVlanType==='dhcp'){var fallback_ip=$(mgmtVlanFallbackIpId).val();if(!validateIpAndNetmask(mgmtVlanFallbackIpId,mgmtVlanFallbackNmId)){return false;}
if(!validateOtherIP(fallback_ip,mgmtVlanFallbackIpId)){return false;}
if(!validateWithAliasIP(fallback_ip,mgmtVlanFallbackIpId)){return false;}
return res_mgmt_id;}}
return true;}
function validateOther(){var wan_type=$(wan_type_id).val();var wan_hostname=$(hostname_id).val();var wan_mtu=$(mtu_id).val();var mgmtVlanEnableVal=$(mgmtVlanEnableId).is(':checked');var mgmtVlanType=$(mgmtVlanTypeId).val();var vlanTagEnableVal=$(vlanTagEnableId).is(':checked');var vlanTagType=$(vlanTagTypeId).val();var wan_ip='',wan_netmask='';var mgmt_ip='',mgmt_netmask='';var wanvlan_ip='',wanvlan_netmask='';var errorFocusWanId='',errorFocusMgmtId='',errorFocusVLANTagId='';clear_validate_error(hostname_id);clear_validate_error(mtu_id);if(typeof wan_hostname!=="undefined"&&!hostname_str(wan_hostname,1,63)){set_err_msg($(hostname_id),true,_('This value must be between %d and %d characters long.').format(1,63)+_('The only characters allowed in the device hostname are ASCII letters, numbers, and dashes.'));return false;}
if(typeof wan_mtu!=="undefined"&&!is_in_range(wan_mtu,1400,1500)){set_err_msg($(mtu_id),true,_('Allowed values are integers between %d and %d, inclusive.').format(1400,1500));return false;}
if(mgmtVlanEnableVal){if(mgmtVlanType==='static'){mgmt_ip=$(mgmtVlanIpId).val();mgmt_netmask=$(mgmtVlanNetmaskId).val();errorFocusMgmtId=mgmtVlanIpId;}else if(mgmtVlanType==='dhcp'){mgmt_ip=$(mgmtVlanFallbackIpId).val();mgmt_netmask=$(mgmtVlanFallbackNmId).val();errorFocusMgmtId=mgmtVlanFallbackIpId;}}
if(vlanTagEnableVal){if(mgmtVlanEnableVal){if(vlanTagType==='static'){wanvlan_ip=$(vlanTagIpId).val();wanvlan_netmask=$(vlanTagNetmaskId).val();errorFocusVLANTagId=vlanTagIpId;}else if(vlanTagType==='dhcp'){wanvlan_ip=$(vlanTagFallbackIpId).val();wanvlan_netmask=$(vlanTagFallbackNmId).val();errorFocusVLANTagId=vlanTagFallbackIpId;}
if(wanvlan_ip===mgmt_ip){set_err_msg($(errorFocusVLANTagId),true,_('Your WAN VLAN IP address is the same as the Mgmt VLAN network IP!'));set_err_msg($(errorFocusMgmtId),true,_('Your Mgmt VLAN network IP is the same as the WAN VLAN IP address!'));return false;}
if(is_in_netmask(mgmt_ip,mgmt_netmask,wanvlan_ip)){set_err_msg($(errorFocusVLANTagId),true,_('Your WAN VLAN IP address falls in the same subnet as the Mgmt VLAN Network IP address.'));return false;}
if(is_in_netmask(wanvlan_ip,wanvlan_netmask,mgmt_ip)){set_err_msg($(errorFocusMgmtId),true,_('Your Mgmt VLAN IP address falls in the same subnet as the WAN VLAN Network IP address.'));return false;}}}else{if(mgmtVlanEnableVal){if(wan_type==='static'){wan_ip=$(wan_ip_id).val();wan_netmask=$(wan_netmask_id).val();errorFocusWanId=wan_ip_id;}else if(wan_type==='dhcp'){wan_ip=$(fallback_ip_id).val();wan_netmask=$(fallback_nm_id).val();errorFocusWanId=fallback_ip_id;}
if(wan_ip===mgmt_ip){set_err_msg($(errorFocusWanId),true,_('Your Internet IP address is the same as the Mgmt VLAN network IP!'));set_err_msg($(errorFocusMgmtId),true,_('Your Mgmt VLAN network IP is the same as the Internet IP address!'));return false;}
if(is_in_netmask(mgmt_ip,mgmt_netmask,wan_ip)){set_err_msg($(errorFocusWanId),true,_('Your Internet IP address falls in the same subnet as the Mgmt VLAN Network IP address.'));return false;}
if(is_in_netmask(wan_ip,wan_netmask,mgmt_ip)){set_err_msg($(errorFocusMgmtId),true,_('Your Mgmt VLAN IP address falls in the same subnet as the WAN Network IP address.'));return false;}}}
return true;}
function validate_inet_src(){if($(inet_src_id).val()=='3g'&&bridged_ifaces){return false;}
return true;}
function validate_all(){var res_ip=validateWANIpAddrs();var res_mgmtvlan=validateMgmtVLAN();var res_vlantag=validateVLANTag();var res_ip_aliases=validateIpAliases();if(res_ip&&res_mgmtvlan&&res_vlantag&&res_ip_aliases){validateOther();}}
function validate_form(){var res_ip=validateWANIpAddrs();var res_mgmtvlan=validateMgmtVLAN();var res_vlantag=validateVLANTag();var res_ip_aliases=validateIpAliases();var res_other=validateOther();var res_inet_src=validate_inet_src();var res=(res_ip&&res_mgmtvlan&&res_mgmtvlan&&res_vlantag&&res_inet_src);if(!res||(res&&!res_other)||!res_ip_aliases){cbi_show_form_error();res=false;}
return res;}
function proto_change(){var wan_type=$(wan_type_id).val();if(wan_type==='static'){$('#ipv6_title').removeClass('hide');}else{$('#ipv6_title').addClass('hide');}}
function inet_src_change(){var inet_src=$(inet_src_id).val();var wan_type=$(wan_type_id).val();var err_msg=_('This internet source cannot be selected.');$('#cbi-network-wan-proto-3g').attr('disabled','disabled');$('#cbi-network-wan-proto-3g').hide();$('#cbid\\.network\\.wan\\.proto option').removeAttr('selected');if(inet_src==='3g'){if(bridged_ifaces){set_err_msg(inet_src_id,true,err_msg);$('#wan_3g_iface_error').removeClass('hidden');}else{set_err_msg(inet_src_id,false,err_msg);$('#wan_3g_iface_error').addClass('hidden');}
$(wan_proto_row).hide();$('#cbi-network-wan-proto-3g').removeAttr('disabled');$('#cbi-network-wan-proto-3g').prop('selected','selected');proto_change();}else{set_err_msg(inet_src_id,false,err_msg);$('#wan_3g_iface_error').addClass('hidden');if(inet_src_ori==='3g'){$(wan_proto_row).show();$('#cbi-network-wan-proto-dhcp').prop('selected','selected');}else{$('#cbi-network-wan-proto-'+wan_type).prop('selected','selected');}}
if(supports_3g&&!linked_3g&&wan_type==='3g'){$('#cbid\\.network\\.wan\\.proto option').removeAttr('selected');$('#cbi-network-wan-proto-dhcp').prop('selected','selected');}
inet_src_ori=inet_src;var lte_service_val=$(lte_service_id).val();if(supports_3g&&lte_service_val==='umts'){$(vlanTagEnableId).attr('checked',false);$('#cbi-network-wanvlan').hide();$('#cbi-network-wan6').hide();}else{$('#cbi-network-wanvlan').show();$('#cbi-network-wan6').show();}
cbi_d_update('cbid.network.wan.proto');}
function vlanTagType_change(){var vlanTagTypeIdVal=$(vlanTagTypeId).val();var wan_type=$(wan_type_id).val();$('#cbi-network-wan-proto-dhcp').hide();$('#cbi-network-wan-proto-static').hide();$('#cbi-network-wan-proto-pppoe').hide();$('#cbi-network-wan-proto-none').hide();$('#cbid\\.network\\.wan\\.proto option').removeAttr('selected');if(vlanTagTypeIdVal==='none'){$('#cbi-network-wan-proto-dhcp').show();$('#cbi-network-wan-proto-static').show();$('#cbi-network-wan-proto-pppoe').show();$('#cbi-network-wan-proto-dhcp').prop('selected','selected');proto_change();}else{$('#cbi-network-wan-proto-none').show();$('#cbi-network-wan-proto-none').prop('selected','selected');proto_change();}
cbi_d_update('cbid.network.wan.proto');}
function vlanTagEnable_change(){var vlanTagEnableVal=$(vlanTagEnableId).is(':checked');$('#cbi-network-wan-proto-dhcp').hide();$('#cbi-network-wan-proto-static').hide();$('#cbi-network-wan-proto-none').hide();$('#cbi-network-wan-proto-pppoe').hide();$('#cbid\\.network\\.wan\\.proto option').removeAttr('selected');if(vlanTagEnableVal){vlanTagType_change();}else{$('#cbi-network-wan-proto-dhcp').show();$('#cbi-network-wan-proto-static').show();$('#cbi-network-wan-proto-pppoe').show();$('#cbi-network-wan-proto-none').show();$('#cbi-network-wan-proto-'+wantype_configured_val).prop('selected','selected');proto_change();}
cbi_d_update('cbid.network.wan.proto');}
function addHandler(){$(wan_ip_id).change(function(){validate_all();});$(wan_netmask_id).change(function(){validate_all();});$(wan_netmask_select_id).change(function(){validate_all();});$(wan_gateway_id).change(function(){validate_all();});$(fallback_ip_id).change(function(){validate_all();});$(fallback_nm_id).change(function(){validate_all();});$(fallback_nm_select_id).change(function(){validate_all();});$(mgmtVlanIpId).change(function(){validate_all();});$(mgmtVlanNetmaskId).change(function(){validate_all();});$(mgmtVlanNetmaskSelectId).change(function(){validate_all();});$(mgmtVlanFallbackNmSelectId).change(function(){validate_all();});$(mgmtVlanGatewayId).change(function(){validate_all();});$(mgmtVlanFallbackIpId).change(function(){validate_all();});$(mgmtVlanFallbackNmId).change(function(){validate_all();});$(mgmtVlanIfnameId).change(function(){validate_all();});$(vlanTagIpId).change(function(){validate_all();});$(vlanTagNetmaskId).change(function(){validate_all();});$(vlanTagNetmaskSelectId).change(function(){validate_all();});$(vlanTagFallbackNmSelectId).change(function(){validate_all();});$(vlanTagGatewayId).change(function(){validate_all();});$(vlanTagFallbackIpId).change(function(){validate_all();});$(vlanTagFallbackNmId).change(function(){validate_all();});$(vlanTagIfnameId).change(function(){validate_all();});}
function getSectionId(val){var idValue=val;var tmpArr='';if(idValue!==undefined){tmpArr=idValue.split('-');}
if(tmpArr===null||tmpArr.length===0||tmpArr===undefined){return null;}
return tmpArr[2];}
function validateIpAliases(){var res=true;var mgmt_type=$(mgmtVlanTypeId).val();var mgmtvlan_checked=$(mgmtVlanEnableId).is(':checked');var wan_type=$(wan_type_id).val();$('.cbi-section-table-row').each(function(){var sectionId=getSectionId(this.id);if(sectionId===null){return;}
var is_deleted=($('#acn\\.del\\.network\\.'+sectionId).val()==='1');var ip_id='#cbid\\.network\\.'+sectionId+'\\.ipaddr';var netmask_id='#cbid\\.network\\.'+sectionId+'\\.netmask';clear_validate_error(ip_id);clear_validate_error(netmask_id);if(!is_deleted){var ip_value=$(ip_id).val();if(!validateIpAndNetmask(ip_id,netmask_id)){res=false;return;}
for(var ipentry in ipdata){if(ipdata.hasOwnProperty(ipentry)){if(!ipentry.startsWith('wan')&&!ipentry.startsWith('mgmt')&&!ipentry.startsWith('vlantag')){var _ipentry=ipdata[ipentry];if(ip_value===_ipentry.ip){set_err_msg($(ip_id),true,_('Your Internet IP address is the same as the %s IP address!').format(_ipentry.friendly));res=false;return;}}}}
if(mgmtvlan_checked){if(mgmt_type=='dhcp'){_ip=$(mgmtVlanFallbackIpId).val();_nm=$(mgmtVlanFallbackNmId).val();}else if(mgmt_type=='static'){_ip=$(mgmtVlanIpId).val();_nm=$(mgmtVlanNetmaskId).val();}
err_msg=_('IP address is in the Mgmt VLAN subnet.');if(is_in_netmask(_ip,_nm,ip_value)){set_err_msg($(ip_id),true,err_msg);res=false;return;}}
if(wan_type==='static'){_ip=$(wan_ip_id).val();_nm=$(wan_netmask_id).val();}else{_ip=$(fallback_ip_id).val();_nm=$(fallback_nm_id).val();}
err_msg=_('IP address is in the WAN subnet.');if(is_in_netmask(_ip,_nm,ip_value)){set_err_msg($(ip_id),true,err_msg);res=false;return;}}});if(!res){$('#cbi-network-wan-_none-tel').css('color','#d16e6c');}else{$('#cbi-network-wan-_none-tel').css('color','');}
return res;}
function add_validation_ipaliases_handlers(val){var sectionId=getSectionId(val);if(sectionId===null){return;}
var $ip_addr=$('#cbid\\.network\\.'+sectionId+'\\.ipaddr');var $netmask=$('#cbid\\.network\\.'+sectionId+'\\.netmask');$ip_addr.change(function(){validate_all();});$netmask.change(function(){validate_all();});$ip_addr.change();$netmask.change();}
function before_submit(){if(!validate_form()){cbi_show_form_error();return false;}else{return true;}}
var inet_src_ori='';$(function(){$('#cbi').submit(function(){return before_submit();});inet_src_ori=$(inet_src_id).val();wantype_configured_val=$(wan_type_id).val();addHandler();if(support_ipv6){$(wan_ipv6_ip_id).change(function(){clear_validate_error(wan_ipv6_ip_id);});}
$(wan_type_id).change(function(){$('#form_error_msg_placeholder').addClass('hide');if(support_ipv6){proto_change();}
addHandler();cbi_init();});$(mgmtVlanEnableId).change(function(){addHandler();validate_all();cbi_init();$(mgmtVlanTypeId).change(function(){addHandler();validate_all();cbi_init();});});$(mgmtVlanTypeId).change(function(){addHandler();validate_all();cbi_init();});$(vlanTagEnableId).change(function(){vlanTagEnable_change();addHandler();validate_all();cbi_init();$(vlanTagTypeId).change(function(){vlanTagType_change();addHandler();validate_all();cbi_init();});});$(vlanTagTypeId).change(function(){vlanTagType_change();addHandler();validate_all();cbi_init();});vlanTagEnable_change();if(support_ipv6){proto_change();}
$(inet_src_id).change(function(){$('#form_error_msg_placeholder').addClass('hide');inet_src_change();});inet_src_change();$('.cbi-section-table-row').each(function(){add_validation_ipaliases_handlers(this.id);});validate_all();});