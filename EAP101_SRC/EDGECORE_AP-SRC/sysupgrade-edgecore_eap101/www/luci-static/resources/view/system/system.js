'use strict';'require view';'require poll';'require ui';'require uci';'require rpc';'require form';var callInitList,callInitAction,callGetLocaltime,callSetLocaltime,CBILocalTime;callInitList=rpc.declare({object:'luci',method:'getInitList',params:['name'],expect:{'':{}},filter:function(res){for(var k in res)
return+res[k].enabled;return null;}});callGetLocaltime=rpc.declare({object:'luci',method:'getLocaltime',expect:{result:0}});callSetLocaltime=rpc.declare({object:'luci',method:'setLocaltime',params:['localtime'],expect:{result:0}});CBILocalTime=form.DummyValue.extend({renderWidget:function(section_id,option_id,cfgvalue){return E([],[E('div',{'id':'localtime','type':'text','style':'margin-top:5px','readonly':true,})]);},});return view.extend({load:function(){return Promise.all([callInitList('sysntpd'),callGetLocaltime(),uci.load('luci'),uci.load('system'),uci.load('acn')]);},render:function(rpc_replies){var ntpd_enabled=rpc_replies[0],timezones=rpc_replies[1],localtime=rpc_replies[2],m,s,o;m=new form.Map('acn',_(''));m.chain('luci');m.chain('system');var s_mgmt=m.section(form.NamedSection,'mgmt','acn',_('Management Settings'));var mgmt_mode=s_mgmt.option(form.ListValue,'management',_('Management'));mgmt_mode.override_values=true;mgmt_mode.value('0',_('Disable'));mgmt_mode.value('1',_('ecCLOUD'));mgmt_mode.cfgvalue=function(section){var mgmt=uci.get('acn',section,'enabled');return mgmt;}
mgmt_mode.write=function(section,value){uci.set('acn',section,'enabled',value);}
var cloud_link=s_mgmt.option(form.DummyValue,'_nothing',_('Controller URL'));cloud_link.depends('management','1');cloud_link.default='https://cloud.ignitenet.com/';cloud_link.custom_style='margin-bottom:5px; padding-top:6px';var reg_url=s_mgmt.option(form.DummyValue,'reg_url',_('Registration URL'));reg_url.depends('management','1');reg_url.default=uci.get('acn','register','url');reg_url.custom_style='margin-bottom:5px; padding-top:6px';s=m.section(form.NamedSection,'settings','acn',_('System Settings'));s.addremove=false;s.anonymous=true;var hostname=s.option(form.Value,'name',_('Hostname'));hostname.datatype='hostname';hostname.default='EAP101';hostname.cfgvalue=function(section){var cloud_enabled=uci.get('acn','mgmt','enabled');if(cloud_enabled=='0'){var standalone_hostname=uci.get('system','@system[0]','hostname');return standalone_hostname;}
else{var cloud_hostname=uci.get('acn','settings','name');return cloud_hostname;}}
hostname.write=function(section,value){var cloud_enabled=uci.get('acn','mgmt','enabled');if(cloud_enabled=='0'){uci.set('system','@system[0]','hostname',value);uci.save('system');}else{var user_hostname=uci.get('system','@system[0]','hostname');if(user_hostname!='hostname.default'){uci.set('acn','settings','name',value);uci.save('acn');}else{uci.set('acn','settings','name',hostname.default);uci.save('acn');}}}
o=s.option(CBILocalTime,'_systime',_('Local Time'));o.cfgvalue=function(){return localtime};o.ntpd_support=ntpd_enabled;var boot_retry=s.option(form.Value,'_boot_retry',_('Number of boot retries for boot bank switch'));boot_retry.default='3';boot_retry.datatype='range(1, 254)';boot_retry.cfgvalue=function(){var retry_count=uci.get('acn','settings','bootmaxcnt');return retry_count;}
boot_retry.write=function(section,value){uci.set('acn','settings','bootmaxcnt',value);}
return m.render().then(function(mapEl){poll.add(function(){return callGetLocaltime().then(function(t){var zone_name=uci.get('system','ntp','zonename');mapEl.querySelector('#localtime').textContent=new Date(t*1000).toLocaleString('en',{timeZone:zone_name,dateStyle:'medium',timeStyle:'long'});});});return mapEl;});}});